#include "Arduino.h"
#include "simple_matrix.h"
#include "stdio.h"

/********************************************************************************
 * Mock functions for Arduino.h
********************************************************************************/
void pinMode(int, int){
}
void digitalWrite(int, int){
}
void SPI_CLASS::transfer(uint8_t a){
//     printf("%02x", a);
}
void SPI_CLASS::begin(void){
}
void SPI_CLASS::setBitOrder(int){
}
void SPI_CLASS::beginTransaction(SPISettings settings){
}
char pgm_read_byte_near(const char*){
  return 0xAA;
}
void delay(int){
}

#define NUMB_OF_LED_MATRICES 4
int return_delay = 30;

SPI_CLASS SPI;
simpleMatrix disp(NUMB_OF_LED_MATRICES);
void (*callback_f)(uint8_t *, int);

uint8_t *return_m(){
  return disp.return_external_matrix();
}

void send_display_buffer(){
  callback_f(return_m(), return_delay);
}

uint8_t TRAIIIINNNNNNN[] = { 
0b11100,
0b101100,
0b1001110,
0b10001110,
0b10001111,
0b10001111,
0b11111111,
0b11111110,
0b11111110,
0b11111110,
0b11111110,
0b11111110,
0b11111111,
0b11111111,
0b11111111,
0b11111110,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b10001111,
0b10001111,
0b11111111,
0b10001110,
0b10001110,
0b11111110,
0b10001110,
0b10001110,
0b11111111,
0b10001111,
0b10001111,
0b11111110,
0b1111100,
0b11111110,
0b11111110,
0b11111111,
0b11111111,
0b11111111,
0b11111110,
0b11111110,
0b11111110,
0b11111110,
0b11111110,
0b11111111,
0b10001111,
0b10001111,
0b10001110,
0b1001110,
0b101100,
0b11100,
0b0
};
uint8_t column_lenght = 232;

extern "C" {
    int test_f(void (*f)(uint8_t *, int)){
    callback_f = f;   // Callback function to give the array to the Python application for processing
    
    // Test application. Change this to what you want
    disp.begin();
//     disp.scrollText("Hello World!", 10);
    return_delay = 45;
    disp.scrollText("CHOOO CHOOO !!!", 10);
    return_delay = 20;
    disp.scrollBuffer(TRAIIIINNNNNNN, 10, column_lenght);  
    
    return 0;
  }
}
